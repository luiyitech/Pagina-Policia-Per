@model Pagina_Policia_Per.Models.NoticiaCreateModel

@{
    ViewData["Title"] = "Nuevo Post";
}

<div class="container my-5 pt-5">
    <h1 class="section-title">Nuevo Post</h1>

    <div class="row">
        <div class="col-md-8 mx-auto">
            <form asp-action="Crear" method="post" enctype="multipart/form-data">
                <div asp-validation-summary="ModelOnly" class="text-danger"></div>

                <div class="mb-3">
                    <label asp-for="Titulo" class="form-label"></label>
                    <input asp-for="Titulo" class="form-control" />
                    <span asp-validation-for="Titulo" class="text-danger"></span>
                </div>

                <div class="mb-3">
                    <label asp-for="Resumen" class="form-label"></label>
                    <textarea asp-for="Resumen" class="form-control" rows="3"></textarea>
                    <span asp-validation-for="Resumen" class="text-danger"></span>
                </div>

                <div class="mb-3">
                    <label asp-for="Contenido" class="form-label"></label>
                    <textarea id="editorContenido" asp-for="Contenido" class="form-control" rows="10"></textarea>
                    <span asp-validation-for="Contenido" class="text-danger"></span>
                </div>

                <div class="mb-3">
                    <label asp-for="ImagenPrincipal" class="form-label">Imagen Principal</label>
                    <input asp-for="ImagenPrincipal" class="form-control" type="file" accept="image/*" />
                    <span asp-validation-for="ImagenPrincipal" class="text-danger"></span>
                </div>

                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-primary">Crear Noticia</button>
                    <a asp-action="Index" class="btn btn-secondary">Cancelar</a>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.ckeditor.com/ckeditor5/41.4.2/super-build/ckeditor.js"></script>

    <script>
        CKEDITOR.ClassicEditor.create(document.querySelector('#editorContenido'), {
            removePlugins: [
                'AIAssistant', 'CKBox', 'CKFinder', 'EasyImage', 'RealTimeCollaborativeComments',
                'RealTimeCollaborativeTrackChanges', 'RealTimeCollaborativeRevisionHistory',
                'PresenceList', 'Comments', 'TrackChanges', 'TrackChangesData', 'RevisionHistory',
                'Pagination', 'WProofreader', 'MathType', 'SlashCommand', 'Template',
                'DocumentOutline', 'FormatPainter', 'TableOfContents', 'PasteFromOfficeEnhanced',
                'MultiLevelList',
                'CaseChange'
            ],
            toolbar: {
                items: [
                    'heading', '|', 'bold', 'italic', 'underline', '|', 'fontColor',
                    'fontBackgroundColor', '|', 'link', 'bulletedList', 'numberedList', '|',
                    'outdent', 'indent', 'alignment', '|',
                    'imageUpload', 'blockQuote', 'insertTable', 'mediaEmbed', '|', // imageUpload está aquí
                    'undo', 'redo'
                ]
            },
            language: 'es',
            simpleUpload: {
                uploadUrl: '/Noticias/UploadImage'
            },

            // --- NUEVA CONFIGURACIÓN PARA IMÁGENES Y REDIMENSIÓN ---
            image: {
                toolbar: [ // Esto es el toolbar que aparece cuando SE SELECCIONA UNA IMAGEN
                    'imageTextAlternative', // Para texto alternativo (accesibilidad)
                    'toggleImageCaption',   // Para añadir/quitar pie de foto
                    'imageStyle:inline',    // Estilo de imagen: en línea con texto
                    'imageStyle:block',     // Estilo de imagen: bloque (centrada)
                    'imageStyle:side',      // Estilo de imagen: a un lado (texto fluye)
                    'imageStyle:wrapText',  // Estilo de imagen: con texto envolvente (para flotar)
                    'imageStyle:breakText', // Estilo de imagen: rompe texto (para que no fluya)
                    'linkImage',            // Para enlazar la imagen
                    'imageResize'           // ¡Este activa el redimensionamiento!
                ],
                // Aquí puedes definir los tamaños de redimensión predefinidos
                resizeOptions: [
                    {
                        name: 'imageResize:original',
                        label: 'Tamaño Original',
                        value: null // null significa tamaño original
                    },
                    {
                        name: 'imageResize:25',
                        label: '25%',
                        value: '25%'
                    },
                    {
                        name: 'imageResize:50',
                        label: '50%',
                        value: '50%'
                    },
                    {
                        name: 'imageResize:75',
                        label: '75%',
                        value: '75%'
                    }
                ]
            },

        })
        .then(editor => {
            console.log('CKEditor fue inicializado correctamente.', editor);
        })
        .catch(error => {
            console.error('Error al inicializar CKEditor:', error);
        });
    </script>
}